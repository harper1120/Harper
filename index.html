<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VC IC Agent - Full System v5.0</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        body { font-family: 'Inter', sans-serif; background: #f1f5f9; }
        .dashboard-card { background: white; border-radius: 2rem; padding: 2rem; border: 1px solid #e2e8f0; box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1); }
        .log-terminal { background: #0f172a; color: #38bdf8; font-family: 'Courier New', Courier, monospace; padding: 1.5rem; border-radius: 1rem; height: 350px; overflow-y: auto; font-size: 0.8rem; line-height: 1.6; }
    </style>
</head>
<body class="p-4 md:p-10 text-slate-900">

    <div class="max-w-6xl mx-auto">
        <header class="flex flex-col md:flex-row justify-between items-end mb-8 gap-6">
            <div>
                <h1 class="text-4xl font-black italic tracking-tighter text-slate-900">VC_REVIEW <span class="text-indigo-600">ENGINE</span></h1>
                <p class="text-slate-500 font-bold mt-2 uppercase tracking-widest text-xs">Jonghyuk Analyst Lab | 20-Panel Virtual IC Protocol</p>
            </div>
            <div class="w-full md:w-96">
                <input type="password" id="api-key" placeholder="Gemini API Key를 입력하세요" class="w-full bg-white border border-slate-200 px-5 py-3 rounded-2xl shadow-sm focus:ring-2 focus:ring-indigo-500 outline-none text-sm transition">
            </div>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8 mb-10">
            <div class="lg:col-span-5 dashboard-card flex flex-col justify-center items-center text-center">
                <div class="w-20 h-20 bg-indigo-50 text-indigo-600 rounded-3xl flex items-center justify-center text-3xl mb-6">
                    <i class="fas fa-file-pdf"></i>
                </div>
                <h3 class="text-xl font-black mb-2 italic">IR 자료 업로드</h3>
                <p class="text-slate-400 text-sm mb-8">검토 대상 기업의 PDF 자료를 선택하세요.</p>
                
                <input type="file" id="pdf-upload" accept=".pdf" class="hidden" onchange="fileReady()">
                <button onclick="document.getElementById('pdf-upload').click()" class="w-full py-4 bg-slate-100 rounded-2xl font-bold text-slate-700 hover:bg-slate-200 transition mb-4">파일 선택</button>
                <button id="run-btn" onclick="startICProcess()" class="w-full py-4 bg-indigo-600 text-white rounded-2xl font-black shadow-lg shadow-indigo-200 opacity-30 cursor-not-allowed transition" disabled>20인 투심위 가동</button>
            </div>

            <div class="lg:col-span-7 dashboard-card bg-slate-900 border-none">
                <h4 class="text-indigo-400 font-black text-xs uppercase tracking-widest mb-4 italic">IC Thinking Process</h4>
                <div id="status-log" class="log-terminal">
                    > 시스템 대기 중... API 키를 입력하고 파일을 선택해 주세요.
                </div>
            </div>
        </div>

        <div id="report-view" class="hidden animate-in fade-in slide-in-from-bottom-10 duration-1000">
            <div class="dashboard-card bg-white border-4 border-slate-900 p-10 mb-8">
                <div class="flex justify-between items-start border-b border-slate-100 pb-8 mb-8">
                    <div>
                        <span class="text-indigo-600 font-black text-xs uppercase tracking-widest block mb-2">Final Investment Report</span>
                        <h2 id="target-corp" class="text-5xl font-black tracking-tighter italic">Target Analysis</h2>
                    </div>
                    <div class="text-right">
                        <div class="text-6xl font-black text-slate-900 leading-none">PASS</div>
                        <p class="text-xs font-bold text-green-500 mt-2 tracking-widest uppercase">Verified by AI Agent</p>
                    </div>
                </div>
                
                <div id="ai-content" class="prose prose-slate max-w-none text-slate-700 font-medium leading-relaxed whitespace-pre-wrap">
                    </div>
            </div>
        </div>
    </div>

    <script>
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.worker.min.js';

        function fileReady() {
            const btn = document.getElementById('run-btn');
            if(document.getElementById('pdf-upload').files[0]) {
                btn.disabled = false;
                btn.classList.remove('opacity-30', 'cursor-not-allowed');
                document.getElementById('status-log').innerHTML += `<br>> [READY] 분석 대상 파일 감지됨.`;
            }
        }

        async function startICProcess() {
            const key = document.getElementById('api-key').value;
            const file = document.getElementById('pdf-upload').files[0];
            const log = document.getElementById('status-log');
            
            if(!key) return alert("Gemini API Key를 입력해주세요.");

            log.innerHTML = `> [STAGE 1] IR PDF 데이터 파싱을 시작합니다...`;
            document.getElementById('run-btn').innerText = "심사 중...";
            document.getElementById('run-btn').disabled = true;

            const reader = new FileReader();
            reader.onload = async function() {
                try {
                    const typedarray = new Uint8Array(this.result);
                    const pdf = await pdfjsLib.getDocument(typedarray).promise;
                    let text = "";
                    for(let i=1; i<=Math.min(pdf.numPages, 15); i++) {
                        const page = await pdf.getPage(i);
                        const content = await page.getTextContent();
                        text += content.items.map(s => s.str).join(' ');
                    }
                    
                    log.innerHTML += `<br>> [STAGE 2] 데이터 추출 완료 (${text.length}자). 20인 VC 패널을 소환합니다.`;
                    executeGemini(key, text, file.name.split('.')[0]);

                } catch (e) {
                    log.innerHTML += `<br><span class="text-red-500">> [ERROR] PDF 읽기 실패: ${e.message}</span>`;
                }
            };
            reader.readAsArrayBuffer(file);
        }

        async function executeGemini(key, content, name) {
            const log = document.getElementById('status-log');
            const report = document.getElementById('report-view');
            const aiContent = document.getElementById('ai-content');
            
            // 종혁님의 20인 투심위 프롬프트 주입
            const prompt = `
            너는 15명의 VC Guru와 5명의 Bright Minds로 구성된 투자심의위원회다. 
            다음 IR 자료를 바탕으로 4단계 프로세스(데이터 추출-15인 개별 평가-3인 집중 토론-최종 리포트)를 아주 디테일하게 수행해.
            특히 리터놀(Returnol)이나 캐시모(Cashmo) 같은 유사 기업들과 비교하며 날카로운 비판을 쏟아내줘.
            창업자에게 던질 날카로운 15개 질문과 심사역을 위한 액션 플랜도 포함해.

            검토 대상 IR 데이터: ${content.substring(0, 15000)}
            `;

            try {
                // [수정된 안정적인 API 주소]
                const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${key}`;
                
                log.innerHTML += `<br>> [STAGE 3] 패널간 끝장 토론 진행 중 (The Bull vs The Bear)...`;

                const res = await fetch(url, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: prompt }] }]
                    })
                });

                const data = await res.json();
                if(data.error) throw new Error(data.error.message);

                const result = data.candidates[0].content.parts[0].text;
                
                log.innerHTML += `<br>> [STAGE 4] 분석 완료. 최종 리포트를 생성합니다.`;
                
                document.getElementById('target-corp').innerText = name;
                aiContent.innerText = result;
                report.classList.remove('hidden');
                window.scrollTo({ top: report.offsetTop - 50, behavior: 'smooth' });

            } catch (e) {
                log.innerHTML += `<br><span class="text-red-500">> [ERROR] API 호출 실패: ${e.message}</span>`;
            } finally {
                document.getElementById('run-btn').innerText = "20인 투심위 가동";
                document.getElementById('run-btn').disabled = false;
            }
        }
    </script>
</body>
</html>
