<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>AI IC Showcase - Real API Mode</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body class="bg-slate-50 p-10">
    <div class="max-w-5xl mx-auto">
        <header class="mb-10 p-8 bg-white rounded-3xl shadow-sm border flex justify-between items-center">
            <div>
                <h1 class="text-3xl font-black italic">VC_REVIEW <span class="text-indigo-600">LIVE</span></h1>
                <p class="text-slate-400 text-xs mt-1 uppercase font-bold">Powered by Gemini 1.5 Pro Engine</p>
            </div>
            <input type="password" id="api-key" placeholder="Gemini API Key 입력" class="border p-2 rounded-lg text-sm w-64">
        </header>

        <section class="bg-indigo-600 p-10 rounded-[2.5rem] text-white shadow-xl mb-10">
            <h2 class="text-xl font-bold mb-4">1. IR 자료 업로드 및 분석</h2>
            <div class="flex gap-4">
                <input type="file" id="pdf-upload" accept=".pdf" class="bg-white/10 p-3 rounded-xl flex-1 text-sm">
                <button onclick="processAndRun()" id="run-btn" class="bg-white text-indigo-600 px-10 py-3 rounded-xl font-black hover:bg-indigo-50 transition">분석 시작</button>
            </div>
        </section>

        <div id="result-display" class="hidden animate-in fade-in duration-1000">
            <div class="bg-white p-12 rounded-[3rem] shadow-2xl border border-slate-200">
                <h3 class="text-xs font-black text-indigo-600 uppercase tracking-widest mb-6 underline decoration-4 underline-offset-8">20-Panel VC Final Report</h3>
                <div id="ai-response" class="prose prose-slate max-w-none font-medium leading-relaxed text-slate-700">
                    </div>
            </div>
        </div>
    </div>

    <script>
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.worker.min.js';

        async function processAndRun() {
            const apiKey = document.getElementById('api-key').value;
            const fileInput = document.getElementById('pdf-upload');
            const runBtn = document.getElementById('run-btn');
            
            if(!apiKey) return alert("API Key를 입력해주세요!");
            if(!fileInput.files[0]) return alert("PDF 파일을 선택해주세요!");

            runBtn.innerText = "20인 VC 소환 중...";
            runBtn.disabled = true;

            // 1. PDF 텍스트 추출
            const reader = new FileReader();
            reader.onload = async function() {
                const typedarray = new Uint8Array(this.result);
                const pdf = await pdfjsLib.getDocument(typedarray).promise;
                let fullText = "";
                for(let i=1; i<=pdf.numPages; i++) {
                    const page = await pdf.getPage(i);
                    const textContent = await page.getTextContent();
                    fullText += textContent.items.map(s => s.str).join(' ');
                }
                
                // 2. Gemini API 호출 (종혁님의 20인 투심위 프롬프트 장착)
                callGemini(apiKey, fullText);
            };
            reader.readAsArrayBuffer(fileInput.files[0]);
        }

        async function callGemini(key, text) {
            const display = document.getElementById('result-display');
            const responseDiv = document.getElementById('ai-response');
            display.classList.remove('hidden');
            responseDiv.innerHTML = "20명의 VC가 토론을 시작했습니다. 잠시만 기다려주세요...";

            const prompt = `
            너는 15명의 VC Guru와 5명의 Bright Minds로 구성된 투자심의위원회다.
            제공된 IR 자료를 읽고 다음 4단계 프로세스를 아주 디테일하게 수행해.
            1. 데이터 추출 (시장, 기술, 팀)
            2. 15인의 개별 투표 결과 (이름 언급하며 논거 제시)
            3. 패널 3인의 끝장 토론 과정 (The Bull vs The Bear)
            4. 창업자 질문 15개와 액션 플랜

            분석할 IR 내용: ${text.substring(0, 10000)} // 토큰 제한 고려
            `;

            try {
                const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-pro:generateContent?key=${key}`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
                });
                const data = await res.json();
                const resultText = data.candidates[0].content.parts[0].text;
                
                // 마크다운 형식으로 변환하여 출력 (간단히)
                responseDiv.innerHTML = resultText.replace(/\n/g, "<br>");
                document.getElementById('run-btn').innerText = "분석 완료";
            } catch (e) {
                responseDiv.innerHTML = "에러 발생: API 키가 잘못되었거나 한도를 초과했습니다.";
            }
        }
    </script>
</body>
</html>
