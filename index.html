<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>AI VC Showcase - Final Fix</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>
</head>
<body class="bg-slate-50 p-10">
    <div class="max-w-2xl mx-auto bg-white p-8 rounded-3xl shadow-lg border">
        <h1 class="text-2xl font-black mb-6 italic">VC_REVIEW <span class="text-indigo-600">STABLE v2</span></h1>
        <div class="space-y-4">
            <input type="password" id="api-key" placeholder="Gemini API Key 입력" class="w-full border p-3 rounded-xl shadow-inner outline-none focus:border-indigo-500">
            <input type="file" id="pdf-input" accept=".pdf" class="w-full text-sm">
            <button onclick="runIC()" id="btn" class="w-full bg-indigo-600 text-white font-black py-4 rounded-xl hover:bg-indigo-700 transition">20인 투심위 가동</button>
        </div>
        <div id="status" class="mt-6 font-mono text-xs text-slate-500 whitespace-pre-wrap bg-slate-50 p-4 rounded-xl hidden"></div>
    </div>

    <script>
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.worker.min.js';

        async function runIC() {
            const key = document.getElementById('api-key').value;
            const file = document.getElementById('pdf-input').files[0];
            const status = document.getElementById('status');
            const btn = document.getElementById('btn');

            if(!key || !file) return alert("Key와 파일을 확인하세요!");

            status.classList.remove('hidden');
            status.innerText = "> 분석 엔진 가동 중...";
            btn.disabled = true;

            const reader = new FileReader();
            reader.onload = async function() {
                try {
                    const typedarray = new Uint8Array(this.result);
                    const pdf = await pdfjsLib.getDocument(typedarray).promise;
                    let text = "";
                    for(let i=1; i<=Math.min(pdf.numPages, 10); i++) {
                        const page = await pdf.getPage(i);
                        const content = await page.getTextContent();
                        text += content.items.map(s => s.str).join(' ');
                    }

                    status.innerText += "\n> 20인 VC 패널에게 데이터를 전송합니다...";

                    // 수정된 API 호출 경로
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${key}`;
                    
                    const res = await fetch(apiUrl, {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({
                            contents: [{ parts: [{ text: `너는 20인 투자심의위원회다. 다음 IR을 4단계로 분석해: ${text.substring(0, 10000)}` }] }]
                        })
                    });

                    const data = await res.json();
                    if(data.error) {
                        status.innerText += `\n> 에러 발생: ${data.error.message}`;
                    } else {
                        status.innerText += "\n\n[분석 결과]\n" + data.candidates[0].content.parts[0].text;
                    }
                } catch (e) {
                    status.innerText += `\n> 중단됨: ${e.message}`;
                }
                btn.disabled = false;
            };
            reader.readAsArrayBuffer(file);
        }
    </script>
</body>
</html>
